{% extends "base.html" %}

{% block title %} Books {% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Left Column: Leaderboard -->
        <div class="col-md-3">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5>Top Rated Books</h5>
                </div>
                {% if leaderboard_books %}
                <ul class="list-group list-group-flush">
                    {% for book in leaderboard_books %}
                    <a href="{{ url_for('books_manager.book', book_id=book.id) }}" class="list-group-item list-group-item-action">
                        <div class="d-flex align-items-center">
                            <img src="{{ book.thumbnail or 'https://via.placeholder.com/40x60' }}" alt="{{ book.title }}" class="me-2" style="width: 40px; height: 60px; object-fit: cover;">
                            <div style="flex-grow: 1;">
                                <strong class="d-block text-truncate">{{ book.title }}</strong>
                                <!-- This is the updated line -->
                                <small class="text-muted">&#9733; {{ book.avg_rating }} ({{ book.rating_count }} ratings)</small>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="card-body">
                    <p class="text-muted">No rated books yet. Be the first to rate one!</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Right Column: Main Content -->
        <div class="col-md-9">
            <!-- Search Bar -->
            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="Search for books..." class="form-control">
            </div>

            <!-- Book Carousels -->
            <div class="scroll-container">
                <div class="book-row" id="bookRow"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // This script remains the same as your original
    const queries = ["Chetan Bhagat", "Harry Potter", "Java Programming", "Machine Learning", "Science Fiction", "OOps", "Python Programming", "Machine Learning", "NLP", "ravinder singh", "durjoy dutta", "arundhati roy"];

    async function fetchBooks(query) {
        const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}`);
        const data = await res.json();
        const bookRow = document.getElementById("bookRow");

        const section = document.createElement("div");
        section.classList.add("query-section");

        data.items?.forEach(book => {
            const info = book.volumeInfo;
            const title = info.title || "Untitled";
            const thumbnail = info.imageLinks?.thumbnail || "https://via.placeholder.com/150x220";

            const card = document.createElement("div");
            card.className = "book-card";
            card.innerHTML = `
            <a href="/book/${book.id}" style="text-decoration: none; color: inherit; display: block;">
              <div class="book-card">
                <img src="${thumbnail}" alt="${title}">
                <p class="title">${title}</p>
              </div>
            </a>
            `;
            section.appendChild(card);
        });
        bookRow.appendChild(section);
    }

    queries.forEach(query => {
        fetchBooks(query);
    });

    document.getElementById("searchInput").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            const keyword = this.value.trim();
            if (keyword) {
                window.location.href = `/book/search/${keyword}`;
            }
        }
    });
</script>

<style>
    /* These styles also remain the same */
    .scroll-container {
        overflow-x: auto;
        white-space: nowrap;
        padding: 20px;
        margin-top: 20px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }
    .book-row {
        display: flex;
        gap: 16px;
    }
    .book-card {
        flex: 0 0 auto;
        width: 150px;
        background-color: #fff;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease-in-out;
    }
    .book-card:hover {
        transform: translateY(-5px);
    }
    .book-card img {
        width: 100%;
        height: 220px;
        object-fit: cover;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
    .book-card .title {
        font-size: 14px;
        padding: 10px;
        color: #333;
        font-weight: bold;
        height: 60px;
        overflow: hidden;
    }
</style>
{% endblock %}
